<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE rfc [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">
]>
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" submissionType="IETF" docName="draft-sabitzer-sapi-password-02" category="std" ipr="trust200902" obsoletes="" updates="" xml:lang="en" symRefs="false" sortRefs="true" tocInclude="true" version="3">
  <!-- xml2rfc v2v3 conversion 3.30.1 -->
  <!-- Generated by id2xml 1.5.2 on 2025-09-08T08:07:08Z -->
	<front>
    <title abbrev="Standard API Password Interface (SAPI) f">Standard API Password Interface (SAPI) for Password Changes</title>
    <seriesInfo name="Internet-Draft" value="draft-sabitzer-sapi-password-02"/>
    <date year="2025" month="September" day="7"/>
    <abstract>
      <t>
   This document specifies the Standard API Password Interface (SAPI),
   a set of interoperable HTTP endpoints for changing and resetting
   user passwords. SAPI enables consistency across services, vendors,
   and government systems, including support for automated changes by
   password managers and for self-service resets using out-of-band
   verification channels (e.g., email, SMS, postal mail, in-person).
   The specification defines discovery, policy reporting (including
   per-channel instructions URLs for slow OOB paths), change and reset
   flows, error semantics, security requirements, and extensibility.</t>
    </abstract>
  </front>
  <middle>
    <section anchor="sect-1" numbered="true" toc="default">
      <name>Introduction</name>
      <dl newline="true" spacing="normal" indent="2">
        <dt>Password changes and resets are implemented inconsistently across</dt>
        <dd>
          <t>
	services. This hinders automation by password managers and increases
   operational risk and user burden. SAPI defines a consistent, secure
   interface for:
   * End-user password changes (current password known).
   * Self-service password resets using out-of-band (OOB) verification
     when the current password is not available, including slow or
     manual channels (postal, in-person/admin).
          </t>
          <ul spacing="compact">
            <li>
              <t>Optional administrative initiation and approval (policy-dependent).</t>
            </li>
          </ul>
        </dd>
      </dl>
      <section anchor="sect-1.1" numbered="true" toc="default">
        <name>Terminology and Conventions</name>
        <t>
   The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”,
   “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and
   “OPTIONAL” in this document are to be interpreted as described in
   BCP 14 (RFC 2119 and RFC 8174) when, and only when, they appear in
   all capitals.</t>
        <t>
   Out-of-band (OOB): verification using a channel different from the
   primary session/API (e.g., email, phone/SMS, postal mail, in-person).</t>
      </section>
      <section anchor="sect-1.2" numbered="true" toc="default">
        <name>Audience and Scope</name>
        <t>
   SAPI is intended for vendors, identity providers, enterprise systems,
   and government agencies that operate user accounts. It is also
   intended to be consumable by password managers and accessibility
   clients that assist users in maintaining account security.</t>
        <t>
   SAPI standardizes *how* to expose change/reset functions. It does not
   mandate *which* identity proofing method is used for OOB verification.</t>
      </section>
      <section anchor="sect-1.3" numbered="true" toc="default">
        <name>Use Cases</name>
        <t>
   (U1) Logged-in change: user supplies current_password and a new_password.</t>
        <dl newline="true" spacing="normal" indent="5">
          <dt>(U2) Forgotten password reset: user cannot authenticate; the server</dt>
          <dd>
	verifies identity via OOB and then permits setting a new password.
	</dd>
          <dt>(U3) Optional admin/helpdesk initiation: a trusted operator initiates</dt>
          <dd>
	OOB verification per policy (e.g., high assurance, government).
	</dd>
        </dl>
      </section>
    </section>
    <section anchor="sect-2" numbered="true" toc="default">
      <name>Overview</name>
      <section anchor="sect-2.1" numbered="true" toc="default">
        <name>Discovery</name>
        <dl newline="true" spacing="normal" indent="2">
          <dt>Services MAY expose a discovery document at the well-known path:</dt>
          <dd>
	/.well-known/sapi-password
	</dd>
          <dt>returning a JSON object with at least:</dt>
          <dd>
            <ul spacing="compact">
              <li>
                <t>"api_base": base URL (e.g., "https://example.com/sapi-password/v1")</t>
              </li>
              <li>
                <t>"supported_channels": array (e.g., ["email","sms","postal"])</t>
              </li>
              <li>
                <t>"policy_endpoint": absolute or relative path to /compliance</t>
              </li>
              <li>
                <t>"channel_instructions": object mapping channel→HTTPS URL (see 3.1)</t>
              </li>
            </ul>
          </dd>
          <dt>If discovery is not implemented, clients SHOULD assume the default</dt>
          <dd>
	base path “/sapi-password/v1/”.
	</dd>
        </dl>
      </section>
      <section anchor="sect-2.2" numbered="true" toc="default">
        <name>Authentication</name>
        <t>
   Endpoints MUST require authenticated requests except where noted.
   Implementations SHOULD support OAuth 2.0 bearer tokens with a scope
   authorizing password changes/resets. Implementations MAY additionally
   accept HTTP Basic authentication for /change (using current credentials)
   to enable compatibility with clients that cannot perform OAuth.
   Administrative initiation, if offered, MUST require elevated scopes.</t>
      </section>
      <section anchor="sect-2.3" numbered="true" toc="default">
        <name>Versioning</name>
        <t>
   The first version is “v1”. Servers MAY later offer “v2”, etc. Clients
   MUST NOT assume backwards compatibility across major versions.</t>
      </section>
    </section>
    <section anchor="sect-3" numbered="true" toc="default">
      <name>Data Models</name>
      <section anchor="sect-3.1" numbered="true" toc="default">
        <name>Policy Document (returned by /compliance)</name>
        <t>
   For any out-of-band channel other than "email" or "sms", servers
   **MUST** provide a stable **HTTPS** URL with human-readable
   instructions for the end user (e.g., postal mail or in-person/admin
   verification steps). This URL **MUST** be advertised via the
   `channel_instructions` map. Instructions SHOULD include expected
   timelines, required documents or approvals, and escalation contacts.</t>
        <t>
   Example:</t>
        <artwork name="" type="" align="left" alt=""><![CDATA[
{
  "compliance": true,
  "min_length": 8,
  "max_length": 128,
  "complexity_requirements": {
    "uppercase": true,
    "lowercase": true,
    "numbers": true,
    "special_characters": true
  },
  "min_uppercase": 1,
  "min_lowercase": 1,
  "min_numbers": 1,
  "min_special": 1,
  "allowed_special_characters": "!@#$%^&*",

  "supported_channels": ["email","sms","postal","admin"],

  "channel_instructions": {
    "postal": "https://id.example.gov/help/postal-reset",
    "admin":  "https://id.example.gov/help/in-person-approval"
  },

  "channel_timelines": {
    "email":  "Typically minutes",
    "sms":    "Typically minutes",
    "postal": "Typically 5–10 business days",
    "admin":  "Varies; schedule with HR/IT"
  },

  "channel_notes": {
    "postal": "Government ID required; code mailed to address on file.",
    "admin":  "Bring photo ID; approval recorded in audit log."
  },

  "password_rotation_days": 90,

  "rate_limits": {
    "change_attempt_cooldown_seconds": 60,
    "oob_code_max_attempts": 3,
    "oob_process_max_attempts": 10
  }
}
]]></artwork>
        <t>
   Fields MAY include additional policy items. Clients and servers SHOULD
   ignore unknown fields.</t>
      </section>
      <section anchor="sect-3.2" numbered="true" toc="default">
        <name>Error Model</name>
        <t>
   Errors SHOULD use HTTP status codes and include a JSON body:</t>
        <artwork name="" type="" align="left" alt=""><![CDATA[
{
  "error": "SECURITY_REQUIREMENT.NOT_STRONG_ENOUGH",
  "error_description": "Password complexity requirements not met",
  "detail": { "min_length": 12, "min_uppercase": 1 }
}
]]></artwork>
        <dl newline="true" spacing="normal" indent="2">
          <dt>RECOMMENDED error codes include:</dt>
          <dd>
            <ul spacing="compact">
              <li>
                <t>AUTH.UNAUTHORIZED</t>
              </li>
              <li>
                <t>INPUT.MALFORMED</t>
              </li>
              <li>
                <t>INPUT.MISSING_PARAMETER</t>
              </li>
              <li>
                <t>SECURITY_REQUIREMENT.NOT_STRONG_ENOUGH</t>
              </li>
              <li>
                <t>SECURITY_REQUIREMENT.PASSWORD_REUSED</t>
              </li>
              <li>
                <t>SECURITY_REQUIREMENT.POLICY_VIOLATION</t>
              </li>
              <li>
                <t>OOB.UNKNOWN_ID</t>
              </li>
              <li>
                <t>OOB.PENDING</t>
              </li>
              <li>
                <t>OOB.REJECTED</t>
              </li>
              <li>
                <t>OOB.ADDITIONAL_CONFIRMATION_REQUIRED</t>
              </li>
              <li>
                <t>RATE_LIMIT.EXCEEDED</t>
              </li>
              <li>
                <t>SERVER.ERROR</t>
              </li>
            </ul>
          </dd>
        </dl>
      </section>
      <section anchor="sect-3.3" numbered="true" toc="default">
        <name>Channel Identifiers and Locale</name>
        <t>
   Channel identifiers are case-insensitive strings, e.g., "email",
   "sms", "postal", "admin". Requests MAY carry a "channel" to indicate
   the desired OOB method when multiple are available. Clients MAY set
   a locale via the HTTP Accept-Language header or an optional JSON
   field "locale" (e.g., "de-DE"). Servers SHOULD honor locale if
   feasible for user-facing communications.</t>
      </section>
    </section>
    <section anchor="sect-4" numbered="true" toc="default">
      <name>Endpoints</name>
      <t>
   All endpoints are under the base path “/sapi-password/v1”. All
   requests MUST be sent over HTTPS. Requests over plaintext MUST be
   rejected (see Security Considerations).</t>
      <section anchor="sect-4.1" numbered="true" toc="default">
        <name>GET /sapi-password/v1/compliance</name>
        <t>
   Purpose: Advertise support and password policy.</t>
        <t>
   Authentication: REQUIRED.</t>
        <dl newline="true" spacing="normal" indent="2">
          <dt>Responses:</dt>
          <dd>
	200 OK with Policy Document (<xref target="sect-3.1" format="default"/>).
     404 Not Found if SAPI is unsupported.
     401 Unauthorized if auth fails.
	</dd>
        </dl>
      </section>
      <section anchor="sect-4.2" numbered="true" toc="default">
        <name>POST /sapi-password/v1/change</name>
        <t>
   Purpose: Change a password when current credentials are available.</t>
        <t>
   Authentication: REQUIRED (OAuth 2.0 RECOMMENDED; HTTP Basic MAY be
   accepted as an alternative using the user’s current credentials).</t>
        <artwork name="" type="" align="left" alt=""><![CDATA[
Request JSON:
{
  "current_password": "string",   // REQUIRED if not using Basic
  "new_password":     "string",   // REQUIRED
  "user_id":          "string"    // OPTIONAL (if applicable)
}
]]></artwork>
        <artwork name="" type="" align="left" alt=""><![CDATA[
Responses:
  200 OK
    {
      "success": true,
      "message": "Password changed successfully",
      "suggested_next_password_rotation_days": 90
    }
  400 Bad Request on policy violation (use Error Model).
  401 Unauthorized on auth failure.
  429 Too Many Requests when rate limited.
]]></artwork>
      </section>
      <section anchor="sect-4.3" numbered="true" toc="default">
        <name>POST /sapi-password/v1/out-of-band-initiate</name>
        <t>
   Purpose: Begin an OOB reset when current credentials are not
   available, or when policy requires OOB approval.</t>
        <t>
   Authentication: REQUIRED (the caller is a client acting for the user,
   or an admin with appropriate scope).</t>
        <artwork name="" type="" align="left" alt=""><![CDATA[
Request JSON:
{
  "username": "user@example.com",     // REQUIRED (or other unique ID)
  "channel":  "email",                // OPTIONAL (server chooses if absent)
  "locale":   "en-US",                // OPTIONAL
  "challenge": "opaque-string"        // OPTIONAL, client-proposed temporary
}
]]></artwork>
        <dl newline="true" spacing="normal" indent="2">
          <dt>Challenge Semantics:</dt>
          <dd>
            <ul spacing="compact">
              <li>
                <t>If "challenge" is omitted, the server MUST generate a secure
       challenge/token and deliver it via the selected OOB channel.</t>
              </li>
            </ul>
            <ul spacing="compact">
              <li>
                <t>If provided, the server MUST NOT activate it until OOB verification
       is completed.</t>
              </li>
            </ul>
          </dd>
        </dl>
        <artwork name="" type="" align="left" alt=""><![CDATA[
Response:
  200 OK
  {
    "id": "oob-process-id",
    "valid_until": "2025-09-14T10:00:00Z",
    "update_interval_seconds": 900,
    "delivery": { "channel": "email" }   // OPTIONAL metadata
  }
]]></artwork>
        <dl newline="true" spacing="normal" indent="2">
          <dt>Errors:</dt>
          <dd>
            <t>
	401 Unauthorized
     404 Not Found (username not recognized) — OPTIONAL: servers MAY
         return 200 with a generic body to avoid enumeration (see Privacy).
            </t>
            <dl newline="true" spacing="compact" indent="-1">
              <dt>429 Too Many Requests</dt>
              <dd/>
            </dl>
          </dd>
        </dl>
      </section>
      <section anchor="sect-4.4" numbered="true" toc="default">
        <name>GET /sapi-password/v1/out-of-band-status</name>
        <t>
   Purpose: Poll the OOB process status.</t>
        <t>
   Authentication: REQUIRED.</t>
        <dl newline="true" spacing="normal" indent="2">
          <dt>Query:</dt>
          <dd>
	?id=oob-process-id
	</dd>
        </dl>
        <artwork name="" type="" align="left" alt=""><![CDATA[
Response:
  200 OK
  {
    "status": "pending" | "completed" | "rejected" | "unknown_id",
    "next_check_seconds": 900
  }
]]></artwork>
        <dl newline="true" spacing="normal" indent="2">
          <dt>Errors:</dt>
          <dd>
	401 Unauthorized
     404 Not Found (if process is unknown and enumeration is permitted)
	</dd>
        </dl>
      </section>
      <section anchor="sect-4.5" numbered="true" toc="default">
        <name>POST /sapi-password/v1/out-of-band-complete</name>
        <t>
   Purpose: Finalize the OOB reset by setting the new password once
   verification is complete.</t>
        <t>
   Authentication: REQUIRED.</t>
        <artwork name="" type="" align="left" alt=""><![CDATA[
Request JSON:
{
  "id": "oob-process-id",              // REQUIRED
  "challenge": "opaque-string",        // REQUIRED (server- or client-generated)
  "new_password": "string",            // REQUIRED
  "additional_confirmation": "string"  // OPTIONAL (e.g., emailed/SMS code)
}
]]></artwork>
        <artwork name="" type="" align="left" alt=""><![CDATA[
Processing:
  - If the OOB process "id" is in state "completed" and "challenge"
    matches the expected value, the server MUST apply policy checks
    and, if satisfied, set the new password.
  - If an additional confirmation code is required and missing or
    incorrect, the server MUST return an error indicating that
    additional confirmation is required (see Error Model).
  - Failed confirmation attempts SHOULD be limited (see policy).

Responses:
  200 OK
  {
    "success": true,
    "message": "Password changed successfully"
  }
]]></artwork>
        <artwork name="" type="" align="left" alt=""><![CDATA[
  400 Bad Request (policy violation; malformed input)
  401 Unauthorized
  404 Not Found (unknown process id if enumeration is permitted)
  409 Conflict (OOB state not completed)
  429 Too Many Requests
]]></artwork>
      </section>
    </section>
    <section anchor="sect-5" numbered="true" toc="default">
      <name>Flows (Non-Normative Examples)</name>
      <section anchor="sect-5.1" numbered="true" toc="default">
        <name>Logged-In Password Change</name>
        <t>
   1) Client calls GET /compliance to learn policy (optional).
   2) Client calls POST /change with current_password and new_password.
   3) Server validates and rotates the password.</t>
      </section>
      <section anchor="sect-5.2" numbered="true" toc="default">
        <name>Out-of-Band Reset (Email/SMS)</name>
        <dl newline="true" spacing="normal" indent="3">
          <dt>1) Client calls POST /out-of-band-initiate with username and channel "email".</dt>
          <dd>
	2) Server generates an OOB code and emails it to the registered address.
   3) Client polls status until "completed" or proceeds to completion with
      the code if required by policy.
	</dd>
          <dt>4) Client calls POST /out-of-band-complete with id, challenge (code),</dt>
          <dd>
	new_password, and additional_confirmation if needed.
	</dd>
        </dl>
      </section>
      <section anchor="sect-5.3" numbered="true" toc="default">
        <name>Out-of-Band Reset (Postal/Manual Approval)</name>
        <dl newline="true" spacing="normal" indent="3">
          <dt>1) Client calls POST /out-of-band-initiate with channel "postal".</dt>
          <dd>
	Server mails a code to the address on file; valid_until may be days.
      The policy’s `channel_instructions["postal"]` explains required
      documents and expected timelines.
	</dd>
          <dt>2) Client polls status periodically (e.g., update_interval_seconds).</dt>
          <dd>
	An administrator MAY mark the process “completed” after in-person
      proofing; the policy’s `channel_instructions["admin"]` page explains
      scheduling and requirements.
	</dd>
          <dt>3) Client calls /out-of-band-complete with id, challenge, new_password.</dt>
          <dd/>
        </dl>
      </section>
    </section>
    <section anchor="sect-6" numbered="true" toc="default">
      <name>Security Considerations</name>
      <ul spacing="normal">
        <li>
          <t>Transport: All endpoints MUST require HTTPS. HTTP requests MUST be
     rejected (e.g., 403 Forbidden or 400 with no sensitive detail).</t>
        </li>
        <li>
          <t>Authentication: OAuth 2.0 bearer tokens with narrowly scoped
     permissions are RECOMMENDED. HTTP Basic MAY be supported for
     /change to enable legacy and password-manager use cases; servers
     MUST rate limit and monitor Basic usage.</t>
        </li>
        <li>
          <t>Rate Limiting: Servers SHOULD implement per-account and per-IP
     throttling. After a configurable number of failures, servers MAY
     require additional verification or temporary lockout.</t>
        </li>
        <li>
          <t>OOB Secrets: Challenges and additional_confirmation values MUST be
     generated with cryptographic randomness, stored securely, and
     invalidated promptly after use or expiration.</t>
        </li>
        <li>
          <t>Enumeration Resistance: Servers SHOULD avoid revealing whether a
     username exists. For /out-of-band-initiate, returning a generic
     200 response without confirming existence is RECOMMENDED in
     consumer-facing deployments, subject to policy and usability.</t>
        </li>
        <li>
          <t>Instructions URLs: `channel_instructions` URLs MUST be HTTPS, MUST
     NOT include PII or secret tokens, and SHOULD avoid leaking whether
     a specific username exists. Pages SHOULD be broadly applicable
     process guidance, not user-specific details.</t>
        </li>
        <li>
          <t>Logging: Sensitive values (passwords, challenges, codes) MUST NOT
     be logged. Audit logs SHOULD record high-level events and metadata
     (timestamps, requesting client, channel) without secrets.</t>
        </li>
        <li>
          <t>Policy Checks: Servers MUST enforce stated complexity and reuse
     policies uniformly across /change and /out-of-band-complete.</t>
        </li>
        <li>
          <t>Admin Operations: If administrative initiation or approval is
     supported, it MUST require elevated scopes/roles and be auditable.</t>
        </li>
      </ul>
    </section>
    <section anchor="sect-7" numbered="true" toc="default">
      <name>Privacy Considerations</name>
      <ul spacing="normal">
        <li>
          <t>Data Minimization: Collect only identifiers necessary to perform
     the reset/change. Do not expose contact details in responses.</t>
        </li>
        <li>
          <t>Communications: OOB messages SHOULD be sent only to verified
     contacts on file. Avoid disclosing sensitive account status in
     OOB messages.</t>
        </li>
        <li>
          <t>Localization: Where locale is supplied, only use it to improve user
     comprehension of OOB communications and instructions pages.</t>
        </li>
        <li>
          <t>Retention: Retain OOB process artifacts only as long as necessary
     for completion and audit per applicable policy/regulation.</t>
        </li>
        <li>
          <t>Instructions Pages: SHOULD describe process steps, timelines, and
     required documents without exposing user-specific data.</t>
        </li>
      </ul>
    </section>
    <section anchor="sect-8" numbered="true" toc="default">
      <name>IANA Considerations</name>
      <t>
   This document requests registration of the following Well-Known URI
   (per RFC 8615):</t>
      <artwork name="" type="" align="left" alt=""><![CDATA[
  URI Suffix: sapi-password
  Change Controller: IETF
  Specification Document: This document

No new media types or registries are defined by this document.
]]></artwork>
    </section>
  </middle>
  <back>
    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>
        <reference>
          <front>
            <!--
   draft-sapi-password-change-02.txt(476): Warning: Failed parsing a reference.
   Are all elements separated by commas (not periods, not just spaces)?:
   RFC 2119  Bradner, S., “Key words for use in RFCs to Indicate
             Requirement Levels”, BCP 14.
   -->
          </front>
        </reference>
        <reference>
          <front>
            <!--
   draft-sapi-password-change-02.txt(479): Warning: Failed parsing a reference.
   Are all elements separated by commas (not periods, not just spaces)?:
   RFC 8174  Leiba, B., “Ambiguity of Uppercase vs Lowercase in RFC 2119
             Key Words”, BCP 14.
   -->
          </front>
        </reference>
        <reference>
          <front>
            <!--
   draft-sapi-password-change-02.txt(482): Warning: Failed parsing a reference.
   Are all elements separated by commas (not periods, not just spaces)?:
   RFC 6749  Hardt, D., “The OAuth 2.0 Authorization Framework”.
   -->
          </front>
        </reference>
        <reference>
          <front>
            <!--
   draft-sapi-password-change-02.txt(484): Warning: Failed parsing a reference.
   Are all elements separated by commas (not periods, not just spaces)?:
   RFC 7617  Reschke, J., “The 'Basic' HTTP Authentication Scheme”.
   -->
          </front>
        </reference>
        <reference>
          <front>
            <!--
   draft-sapi-password-change-02.txt(486): Warning: Failed parsing a reference.
   Are all elements separated by commas (not periods, not just spaces)?:
   RFC 8615  Nottingham, M., “Well-Known Uniform Resource Identifiers
             (URIs)”.
   -->
          </front>
        </reference>
      </references>
      <references>
        <name>Informative References</name>
        <reference>
          <front>
            <!--
   draft-sapi-password-change-02.txt(491): Warning: Failed parsing a reference.
   Are all elements separated by commas (not periods, not just spaces)?:
   RFC 3062  Zeilenga, K., “LDAP Password Modify Extended Operation”.
   -->
          </front>
        </reference>
        <reference>
          <front>
            <!--
   draft-sapi-password-change-02.txt(493): Warning: Failed parsing a reference.
   Are all elements separated by commas (not periods, not just spaces)?:
   RFC 7644  Hunt, P., et al., “System for Cross-domain Identity
             Management (SCIM): Protocol”.
   -->
          </front>
        </reference>
        <reference>
          <front>
            <!--
   draft-sapi-password-change-02.txt(496): Warning: Failed parsing a reference.
   Are all elements separated by commas (not periods, not just spaces)?:
   NIST SP 800-63A  “Digital Identity Guidelines: Enrollment and
             Identity Proofing”.
   -->
          </front>
        </reference>
      </references>
    </references>
    <section anchor="sect-10" numbered="true" toc="default">
      <name>Acknowledgments</name>
      <t>
   The author thanks the implementers and reviewers who provided feedback
   on discovery, error semantics, OOB clarity, instructions URLs, and
   privacy guidance.</t>
    </section>
    <section anchor="sect-11" numbered="true" toc="default">
      <name>Author’s Address</name>
    </section>
  </back>
</rfc>
